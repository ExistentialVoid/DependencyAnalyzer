using System.Collections.Generic;
using System.Reflection;

namespace DependencyAnalyzer
{
    public abstract class ReferenceInfo
    {
        internal bool IsClosure => Member.Name.Contains(">c__DisplayClass");
        internal bool IsCompilerClass => Member.Name.Equals("<>c");
        /// <summary>
        /// This member is auto-generated by the compiler (including static constructors, .cctor)
        /// </summary>
        internal bool IsCompilerGenerated
        {
            get
            {
                string name = Member is TypeInfo t ? t.FullName ?? t.Name : Member.Name;
                return name.Contains('>') || name.Contains(".cctor");
            }
        }
        public MemberInfo Member { get; }
        /// <summary>
        /// The member presented similar to how it appears in source code
        /// </summary>
        public string Signature
        {
            get
            {
                if (_cachedSignature.Equals(string.Empty)) _cachedSignature = SignatureBuilder.GetSignature(Member);
                return _cachedSignature;
            }
        }

        private string _cachedSignature = string.Empty;


        public ReferenceInfo(MemberInfo member)
        {
            Member = member;
        }


        internal abstract void FindReferencedMembers(IEnumerable<ClassReferenceInfo> referenceTypes);
        internal abstract void FindReferencingMembers(IEnumerable<ClassReferenceInfo> referenceTypes);
    }
}
